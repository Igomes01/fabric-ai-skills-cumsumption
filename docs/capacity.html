<!DOCTYPE html>
<html lang="pt-BR" data-lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-i18n="title_capacity">Capacidade Copilot Fabric</title>
  <meta name="description" content="Calculadora de capacidade (CU) para uso do Copilot no Fabric." />
  <style>
    :root { --brand:#0F6CBD; --accent:var(--brand); --accent-hover:#0D5FA5; --bg:#0b0b0c; --panel:#1b1d20; --panel-alt:#22252a; --font: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; --border:#2d3237; --border-strong:#3a4148; --text:#f5f7fa; --text-soft:#c2c8d0; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: var(--font); background:radial-gradient(circle at 25% 15%, #14181d 0%, var(--bg) 65%); color:var(--text); display:flex; flex-direction:column; min-height:100vh; }
    header { padding:1.4rem 1.2rem .4rem; text-align:center; position:relative; }
    h1 { margin:0 0 .35rem; font-size:1.7rem; font-weight:600; }
    p.lead { margin:.2rem 0 1.2rem; font-size:.85rem; color:var(--text-soft); }
    main { width:100%; max-width:1000px; margin:0 auto; padding:0 1rem 2.8rem; flex:1; }
    .panel { background:linear-gradient(145deg,var(--panel),var(--panel-alt)); border:1px solid var(--border); border-radius:18px; padding:1.05rem 1.15rem 1.4rem; box-shadow:0 4px 28px -10px #000; }
    .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); margin:.3rem 0 1.1rem; }
    label { display:flex; flex-direction:column; gap:.45rem; font-size:.68rem; letter-spacing:.08em; text-transform:uppercase; font-weight:600; color:var(--text-soft); }
    input[type=number] { width:100%; padding:.65rem .7rem; border:1px solid var(--border); border-radius:10px; background:#101418; color:var(--text); font:600 14px/1 var(--font); }
    input:focus { outline:2px solid var(--accent); outline-offset:2px; }
    small.hint { font-size:.58rem; font-weight:400; text-transform:none; letter-spacing:0; color:var(--text-soft); }
    .actions { display:flex; gap:.8rem; flex-wrap:wrap; margin-top:.5rem; }
    button { cursor:pointer; border:1px solid var(--border-strong); border-radius:10px; font:600 14px/1 var(--font); padding:.8rem 1.25rem; background:var(--accent); color:#fff; box-shadow:0 4px 16px -6px rgba(15,108,189,.55); transition:.25s; }
    button:hover { background:var(--accent-hover); transform:translateY(-2px); box-shadow:0 6px 20px -6px rgba(15,108,189,.65); }
    button.secondary { background:#272c31; color:var(--text-soft); }
    button.secondary:hover { background:#30363c; color:var(--text); }
    .result { margin-top:1.35rem; background:linear-gradient(160deg,var(--panel-alt),#1c2227); border:1px solid var(--border-strong); border-radius:18px; padding:1rem 1.15rem 1.4rem; }
    .kpi { background:#12161a; border:1px solid var(--border); border-radius:12px; padding:.7rem .85rem .75rem; position:relative; overflow:hidden; }
    .kpi:before { content:""; position:absolute; inset:0; background:linear-gradient(140deg,rgba(15,108,189,.15),rgba(15,108,189,0) 55%); opacity:.6; pointer-events:none; }
    .kpi h3 { margin:0 0 .35rem; font:600 .6rem/1 var(--font); letter-spacing:.13em; text-transform:uppercase; color:var(--text-soft); }
    .kpi p { margin:0; font:600 1.15rem/1.1 var(--font); letter-spacing:.45px; color:var(--text); }
    table { width:100%; border-collapse:collapse; font-size:.68rem; }
    th,td { padding:.45rem .55rem; text-align:left; border-bottom:1px solid #2d425f; }
    thead { background:#162235; }
    tbody tr:hover { background:#1b2c44; }
    footer { text-align:center; padding:1.2rem 0 1.6rem; font-size:.65rem; opacity:.55; }
  footer a { color:var(--accent); text-decoration:none; font-weight:600; }
  footer a:hover { text-decoration:underline; }
    .note { font-size:.6rem; opacity:.55; line-height:1.35; }
    .fade { animation:fade .4s ease; }
    @keyframes fade { from{opacity:0; transform:translateY(6px);} to{opacity:1; transform:translateY(0);} }
    .link-back { position:fixed; top:10px; left:12px; font-size:.7rem; background:#20262b; border:1px solid var(--border); padding:.45rem .65rem; border-radius:8px; text-decoration:none; color:var(--text-soft); }
    .link-back:hover { background:#2a3137; color:var(--text); }
    .warning { color:#FFB900; font-size:.6rem; margin-top:.25rem; }
    .lang-switch { position:absolute; top:14px; right:14px; display:flex; gap:.5rem; }
    .lang-btn { background:#20262b; border:1px solid var(--border); color:var(--text-soft); font:600 11px/1 var(--font); padding:.45rem .7rem; border-radius:8px; cursor:pointer; letter-spacing:.05em; text-transform:uppercase; display:inline-flex; align-items:center; gap:.35rem; }
    .lang-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; box-shadow:0 0 0 3px rgba(15,108,189,.35); }
    .lang-btn:not(.active):hover { background:#2a3137; color:var(--text); }
  </style>
</head>
<body>
  <!-- link-back removido; agora botão dentro do form -->
  <header>
    <div class="lang-switch" id="langSwitchCap">
      <button class="lang-btn active" data-lang-select="pt-BR">PT-BR</button>
      <button class="lang-btn" data-lang-select="en-US">EN-US</button>
    </div>
    <h1 data-i18n="title_capacity">Capacidade Necessária (Copilot Fabric)</h1>
    <p class="lead" data-i18n="subtitle_capacity">Informe apenas os três valores. Usamos razões padrão (tokens/palavra ≈ 1.333, saída 4×) para estimar capacidade (CU aproximada).</p>
  </header>
  <main>
    <section class="panel">
      <form id="formCap">
        <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr));">
          <label><span data-i18n="label_users_day">Usuários por dia</span>
            <input type="number" id="usuariosDia" min="1" value="1500" step="10" />
          </label>
          <label><span data-i18n="label_questions_user">Perguntas por usuário</span>
            <input type="number" id="perguntasUsuario" min="1" value="5" step="1" />
          </label>
          <label><span data-i18n="label_avg_words_question">Palavras médias por pergunta</span>
            <input type="number" id="palavrasPergunta" min="1" value="50" step="1" />
            <small class="hint" data-i18n="hint_from_other">Pode vir da outra página</small>
          </label>
        </div>
        <div class="actions">
          <button type="button" id="btnCalcular" data-i18n="btn_calculate">Calcular</button>
          <button type="reset" class="secondary" id="btnReset" data-i18n="btn_clear">Limpar</button>
          <button type="button" class="secondary" id="btnIrIndex" data-i18n="btn_to_index">Estimar tokens com Exemplos de Inputs</button>
        </div>
      </form>
      <p class="warning" data-i18n="warning_capacity">Esta calculadora é aproximada e serve para planejamento inicial. Ajuste com métricas reais depois.</p>
      <div id="resultado" class="result fade" style="display:none;">
        <div id="metricas" style="display:grid; gap:.85rem; grid-template-columns:repeat(auto-fit,minmax(170px,1fr));"></div>
        <p class="note" data-i18n="note_formulas" style="margin-top:1rem;">Fórmulas: cu_seconds = (in_tokens*100 + out_tokens*400)/1000 • cu_min = cu_seconds/60 • cu_hours = cu_seconds/3600 • capacidade = (req_dia * cu_hours)/24<br>Constantes padrão: tokens/palavra ≈ 1.333 • saída = 4×</p>
      </div>
    </section>
  </main>
  <footer>
    <span data-i18n="footer_capacity">Unofficial Microsoft Calculator • For best CU accuracy, use the Fabric Capacity Estimator • No data is sent or saved</span>
    <span style="opacity:.35;"> • </span>
    <a href="https://github.com/Igomes01/fabric-ai-skills-cumsumption" target="_blank" rel="noopener noreferrer" data-i18n="doc_link_label">Documentation (GitHub)</a>
  </footer>
<script>
(function(){
  const $ = s => document.querySelector(s);
  const metricasEl = $('#metricas');
  const resultado = $('#resultado');
  const langSwitch = $('#langSwitchCap');

  const I18N = {
    'pt-BR': {
      title_capacity: 'Estimativa de CU do Fabric para Copilot e Data Agents',
      subtitle_capacity: 'Calculadora de Unidade Computacional para estimar o consumo de Copilot e Data Agent no Fabric.',
      label_users_day: 'Usuários por dia',
      label_questions_user: 'Perguntas por usuário',
      label_avg_words_question: 'Palavras médias por pergunta',
      hint_from_other: 'Pode vir da outra página',
      btn_calculate: 'Calcular',
      btn_clear: 'Limpar',
      warning_capacity: 'Esta calculadora é aproximada e serve para planejamento inicial. Ajuste com métricas reais depois.',
      note_formulas: 'Para maior acurácia, use Estimar tokens com Exemplos de Inputs',
      label_cu_seconds: 'CU por Segundo',
      label_cu_minute: 'CU por Minuto',
      label_cu_hours: 'CU por Hora',
      label_requests_day: 'Requisições por Dia',
      label_capacity_need: 'Capacidade Necessária',
  link_back: '← Estimar tokens médios',
  btn_to_index: 'Estimar tokens com Exemplos de Inputs →',
      footer_capacity: 'Unofficial Microsoft Calculator • For best CU accuracy, use the Fabric Capacity Estimator • No data is sent or saved',
  doc_link_label: 'Documentação (GitHub)',
      alert_fill: 'Preencha valores > 0'
    },
    'en-US': {
      title_capacity: 'Fabric CU Estimation for Copilot and Data Agent',
      subtitle_capacity: 'Compute Unit Calculator to estimate Copilot and Data Agent consumption in Fabric.',
      label_users_day: 'Users per day',
      label_questions_user: 'Questions per user',
      label_avg_words_question: 'Avg words per question',
      hint_from_other: 'May come from previous page',
      btn_calculate: 'Calculate',
      btn_clear: 'Clear',
      warning_capacity: 'Approximate calculator for initial planning. Refine with real metrics later.',
      note_formulas: 'For more Accuracy, use Estimate tokens with Sample Inputs',
      label_cu_seconds: 'CU Seconds',
      label_cu_minute: 'CU Minute',
      label_cu_hours: 'CU Hours',
      label_requests_day: 'Requests / Day',
      label_capacity_need: 'Capacity Need',
  link_back: '← Estimate avg tokens',
  btn_to_index: 'Estimate tokens with Sample Inputs →',
      footer_capacity: 'Unofficial Microsoft Calculator • For best CU accuracy, use the Fabric Capacity Estimator • No data is sent or saved',
  doc_link_label: 'Documentation (GitHub)',
      alert_fill: 'Fill values > 0'
    }
  };
  let currentLang = localStorage.getItem('langPref') || 'pt-BR';
  function t(k){ return (I18N[currentLang] && I18N[currentLang][k]) || k; }
  function applyI18n(){
    document.documentElement.setAttribute('lang', currentLang);
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      // Preserve child elements (like inputs inside labels) by only replacing text nodes
      const key = el.dataset.i18n;
      const translated = t(key);
      if(el.children.length === 0){
        // Simple element (no children) -> replace full text/HTML (allow <br> in notes)
        if(translated.includes('<br')){
          el.innerHTML = translated;
        } else {
          el.textContent = translated;
        }
      } else {
        // Has children: find first text node
        let textNode = Array.from(el.childNodes).find(n=> n.nodeType===Node.TEXT_NODE);
        if(textNode){
          textNode.textContent = translated + ' ';
        } else {
          el.insertBefore(document.createTextNode(translated+' '), el.firstChild);
        }
      }
    });
    langSwitch.querySelectorAll('.lang-btn').forEach(btn=>btn.classList.toggle('active', btn.dataset.langSelect===currentLang));
  }

  // Se vier média de tokens ou palavras por query via querystring (ex: ?avgWords=42)
  const params = new URLSearchParams(location.search);
  if(params.has('avgWords')) { $('#palavrasPergunta').value = Number(params.get('avgWords')); }

  function calcular(){
    const palavras = Number($('#palavrasPergunta').value)||0;
    const usuarios = Number($('#usuariosDia').value)||0;
    const perguntasUsuario = Number($('#perguntasUsuario').value)||0;
    const ratio = 1.333; // constante
    const multSaida = 4;  // constante
    if(!palavras || !usuarios || !perguntasUsuario){ alert(t('alert_fill')); return; }
    const inputTokens = palavras * ratio;
    const outputTokens = inputTokens * multSaida;
    const cuSeconds = (inputTokens * 100 + outputTokens * 400) / 1000;
    const cuMinutes = cuSeconds / 60;
    const cuHours = cuSeconds / 3600;
    const requestsDia = usuarios * perguntasUsuario;
    const capacidadeNeed = (requestsDia * cuHours) / 24;
    render({cuSeconds, cuMinutes, cuHours, requestsDia, capacidadeNeed});
  }

  function render(m){
    resultado.style.display='block';
    metricasEl.innerHTML = `
      <div class="kpi"> <h3>${t('label_cu_seconds')}</h3><p>${m.cuSeconds.toFixed(2)}</p></div>
      <div class="kpi"> <h3>${t('label_cu_minute')}</h3><p>${m.cuMinutes.toFixed(3)}</p></div>
      <div class="kpi"> <h3>${t('label_cu_hours')}</h3><p>${m.cuHours.toFixed(6)}</p></div>
      <div class="kpi" style="border:1px solid var(--accent); box-shadow:0 0 0 2px rgba(15,108,189,.25);"> <h3>${t('label_requests_day')}</h3><p>${m.requestsDia.toLocaleString(currentLang==='pt-BR'?'pt-BR':'en-US')}</p></div>
  <div class="kpi" style="border:1px solid var(--accent); box-shadow:0 0 0 2px rgba(15,108,189,.25);"> <h3>${t('label_capacity_need')}</h3><p>${m.capacidadeNeed.toFixed(6)}</p></div>`;
  }

  $('#btnCalcular').addEventListener('click', calcular);
  $('#btnReset').addEventListener('click', ()=>{ resultado.style.display='none'; metricasEl.innerHTML=''; });
  const btnIrIndex = document.getElementById('btnIrIndex');
  btnIrIndex.addEventListener('click', ()=>{ window.location.href='index.html'; });
  langSwitch.addEventListener('click', e=>{
    const btn = e.target.closest('[data-lang-select]');
    if(!btn) return;
    currentLang = btn.dataset.langSelect;
    localStorage.setItem('langPref', currentLang);
    applyI18n();
    if(resultado.style.display!=='none') calcular();
  });

  applyI18n();
})();
</script>
</body>
</html>
